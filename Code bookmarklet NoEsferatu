javascript:(function(){var p=document.getElementById("esfera-panel");if(p){p.style.zIndex='999999';p.scrollIntoView({behavior:'smooth',block:'center'});return;}if(window._processingEsfera===true){alert("Ja hi ha un proc√©s en marxa. Espera que acabi.");return;}var panelWidth=Math.max(1200,window.innerWidth-50);var panelHeight=Math.max(250,Math.floor(window.innerHeight*0.5));var e='<div id="esfera-panel" style="position:fixed;top:30px;left:25px;width:'+panelWidth+'px;height:'+panelHeight+'px;background:#f1f1f1;z-index:999999;border:2px solid #333;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,0.3);resize:both;overflow:hidden;display:flex;flex-direction:column;max-height:90vh;max-width:95vw"><div id="esfera-header" style="background:#333;color:white;padding:8px 12px;cursor:move;display:flex;justify-content:space-between;align-items:center;user-select:none"><span style="font-weight:bold;font-size:14px">NoEsfer@tu - Control de notes a Esfer@</span><button id="tancarBtn" style="background:transparent;color:white;border:none;cursor:pointer;font-size:20px;padding:2px 6px">√ó</button></div><div style="display:flex;flex-direction:column;height:100%"><div style="padding:10px;border-bottom:1px solid #ddd;flex-shrink:0"><div style="display:flex;gap:10px;align-items:center"><button id="instruccionsBtn" style="padding:8px 12px;background:#9c27b0;color:white;border:none;border-radius:3px;cursor:pointer;font-size:14px;flex-shrink:0">üìñ Instruccions</button><button id="enganxaTotBtn" style="padding:8px 12px;background:#87CEEB;color:white;border:none;border-radius:3px;cursor:pointer;font-size:14px;flex-shrink:0">Enganxa tot</button><textarea id="textComplert" style="flex-grow:1;height:35px;padding:6px;border:1px solid #ccc;border-radius:3px;font-size:13px" placeholder="Enganxa tot el text amb les columnes separades per tabulacions"></textarea><div style="display:flex;gap:8px;flex-shrink:0"><button id="desaDadesBtn" style="padding:8px 12px;background:#90EE90;color:black;border:none;border-radius:3px;cursor:pointer;font-size:13px">Desar modificacions</button><button id="netejarBtn" style="padding:8px 12px;background:#ff9800;color:white;border:none;border-radius:3px;cursor:pointer;font-size:13px">Netejar dades</button><button id="processarBtn" style="padding:10px 18px;background:#2196F3;color:white;border:none;border-radius:5px;cursor:pointer;font-weight:bold;font-size:14px">Processar dades</button></div></div></div><div style="flex:1;overflow:hidden;padding:10px"><div style="display:flex;flex-direction:column;background:#f9f9f9;padding:8px;border-radius:5px;border:1px solid #ddd;height:100%"><div style="display:flex;background:#e0e0e0;border-radius:3px 3px 0 0;font-weight:bold;font-size:12px;text-align:center;border-bottom:1px solid #999"><div style="width:95px;padding:3px;border-right:1px solid #999;flex-shrink:0">ID</div><div style="width:150px;padding:3px;border-right:1px solid #999;flex-shrink:0">Nom</div><div style="width:75px;padding:3px;border-right:1px solid #999;flex-shrink:0">Nota</div><div style="flex:1;padding:3px">Comentaris</div></div><textarea id="dadesUnificades" style="width:100%;flex:1;padding:4px;border:none;border-radius:0 0 3px 3px;font-family:Consolas,Monaco,monospace;font-size:12px;line-height:22px;resize:none;overflow:auto;background:white;outline:none;white-space:pre;tab-size:4" placeholder="Enganxa tot el text amb les columnes separades per tabulacions"></textarea></div></div></div></div>';var t=document.createElement("div");t.innerHTML=e;var n=t.firstChild;document.body.appendChild(n);var isDragging=false;var dragOffsetX=0;var dragOffsetY=0;var header=document.getElementById("esfera-header");var ordreOriginal=[];function constrainPosition(){var rect=n.getBoundingClientRect();var newLeft=parseInt(n.style.left)||25;var newTop=parseInt(n.style.top)||30;var minLeft=10;var minTop=10;var maxLeft=Math.max(10,window.innerWidth-rect.width-10);var maxTop=Math.max(10,window.innerHeight-rect.height-50);var maxHeight=window.innerHeight*0.9;var maxWidth=window.innerWidth*0.95;if(rect.height>maxHeight){n.style.height=maxHeight+"px";}if(rect.width>maxWidth){n.style.width=maxWidth+"px";}if(newLeft<minLeft)newLeft=minLeft;if(newLeft>maxLeft)newLeft=maxLeft;if(newTop<minTop)newTop=minTop;if(newTop>maxTop)newTop=maxTop;n.style.left=newLeft+"px";n.style.top=newTop+"px";}header.addEventListener("mousedown",function(e){if(e.target.id==="tancarBtn")return;isDragging=true;dragOffsetX=e.clientX-n.offsetLeft;dragOffsetY=e.clientY-n.offsetTop;document.addEventListener("mousemove",dragMove);document.addEventListener("mouseup",dragEnd);e.preventDefault();});function dragMove(e){if(!isDragging)return;var newLeft=e.clientX-dragOffsetX;var newTop=e.clientY-dragOffsetY;n.style.left=newLeft+"px";n.style.top=newTop+"px";constrainPosition();}function dragEnd(){isDragging=false;document.removeEventListener("mousemove",dragMove);document.removeEventListener("mouseup",dragEnd);}window.addEventListener("resize",constrainPosition);var saved=sessionStorage.getItem("esfera_dades_alumnes");var savedOrder=sessionStorage.getItem("esfera_ordre_alumnes");if(saved){var data=JSON.parse(saved);var alumnes;if(savedOrder){try{alumnes=JSON.parse(savedOrder).filter(id=>data[id]);}catch(e){alumnes=Object.keys(data);}}else{alumnes=Object.keys(data);}actualitzarVisualitzacio(alumnes,data);}function truncarPerVisualitzacio(text,maxLen){if(!text)return '';text=String(text);if(text.length<=maxLen)return text;return text.substring(0,maxLen-3)+'...';}function formatarLiniaPerVisualitzacio(id,nom,nota,comentari){var idTruncat=truncarPerVisualitzacio(id,12);var nomTruncat=truncarPerVisualitzacio(nom,20);var notaTruncada=truncarPerVisualitzacio(nota,10);var idPadded=idTruncat.padEnd(12,' ');var nomPadded=nomTruncat.padEnd(20,' ');var notaPadded=notaTruncada.padEnd(10,' ');return idPadded+'\t'+nomPadded+'\t'+notaPadded+'\t'+(comentari||'');}function actualitzarVisualitzacio(alumnes,data){var linies=[];for(var i=0;i<alumnes.length;i++){var key=alumnes[i];var alumne=data[key];var comentariLines=alumne.comentari?alumne.comentari.split('\n'):[''];for(var j=0;j<comentariLines.length;j++){var id=j===0?key:'';var nom=j===0?alumne.nom||'':'';var nota=j===0?alumne.nota||'':'';var comentari=comentariLines[j]||'';linies.push(formatarLiniaPerVisualitzacio(id,nom,nota,comentari));}}document.getElementById("dadesUnificades").value=linies.join('\n');aplicarEstilsAlternats(alumnes,data);}function aplicarEstilsAlternats(alumnes,data){var textarea=document.getElementById("dadesUnificades");var gradients=[];var currentLine=0;for(var i=0;i<alumnes.length;i++){var key=alumnes[i];var alumne=data[key];var comentariLines=alumne.comentari?alumne.comentari.split('\n').length:1;var startLine=currentLine*22;var endLine=(currentLine+comentariLines)*22;var color=i%2===0?'rgba(255,255,255,0.9)':'rgba(240,248,255,0.9)';gradients.push(color+' '+startLine+'px',color+' '+endLine+'px');currentLine+=comentariLines;}if(gradients.length>0){textarea.style.background='repeating-linear-gradient('+gradients.join(',')+')';}textarea.style.backgroundAttachment='local';}function normalitzarSaltsLinia(text){return text.replace(/\r\n/g,'\n').replace(/\r/g,'\n');}function processarTextMultilinia(text){text=normalitzarSaltsLinia(text);var lines=text.split('\n');var records=[];var currentRecord=null;for(var i=0;i<lines.length;i++){var line=lines[i];if(/^\d+\t/.test(line)){if(currentRecord){records.push(currentRecord);}var parts=line.split('\t');currentRecord={id:parts[0]||'',nom:parts[1]||'',nota:parts[2]||'',comentari:normalitzarSaltsLinia(parts.slice(3).join('\t')||'')};}else if(currentRecord&&line.trim()){var parts=line.split('\t');var commentPart=parts.length>=4?parts.slice(3).join('\t'):parts[parts.length-1]||'';if(commentPart.trim()){currentRecord.comentari+='\n'+normalitzarSaltsLinia(commentPart.trim());}else if(parts.length===1&&parts[0].trim()){currentRecord.comentari+='\n'+normalitzarSaltsLinia(parts[0].trim());}}}if(currentRecord){records.push(currentRecord);}return records;}function parseTextareaUnificada(){var linies=document.getElementById("dadesUnificades").value.split('\n');var dades={};var currentOrder=[];var currentId=null;for(var i=0;i<linies.length;i++){var linia=linies[i];if(!linia.trim())continue;var parts=linia.split('\t');var id=parts[0]?parts[0].trim().replace(/\.\.\.$/,''):'';var nom=parts[1]?parts[1].trim().replace(/\.\.\.$/,''):'';var nota=parts[2]?parts[2].trim().replace(/\.\.\.$/,''):'';var comentari=normalitzarSaltsLinia(parts.slice(3).join('\t'));if(id){currentId=id;if(nota==="")nota="en blanc";dades[id]={nom:nom,nota:nota,comentari:netejarCometes(comentari.trim())};if(!currentOrder.includes(id)){currentOrder.push(id);}}else if(currentId&&parts.length>0){var comentariExtra=normalitzarSaltsLinia(parts.slice(0).join('\t').trim());if(comentariExtra){dades[currentId].comentari+='\n'+netejarCometes(comentariExtra);}}}return{dades:dades,ordre:currentOrder};}function netejarCometes(text){return text.replace(/^["']|["']$/g,'').replace(/\\"/g,'"').replace(/\\'/g,"'");}function obtenirAlumnesPerProcessar(dades){var totsElsAlumnesDOM=Array.from(document.querySelectorAll('#my-tab-content tbody tr, .grades-table tbody tr'));var alumnesPerProcessar=[];var usats=new Set();totsElsAlumnesDOM.forEach(function(fila){var celdaId=fila.querySelector('td:nth-child(1)');if(!celdaId)return;var idAlumne=celdaId.textContent.trim();if(!dades[idAlumne]||usats.has(idAlumne))return;usats.add(idAlumne);alumnesPerProcessar.push({fila:fila,id:idAlumne,alumne:dades[idAlumne]});});return alumnesPerProcessar;}document.getElementById("tancarBtn").addEventListener("click",function(){document.body.removeChild(n)});document.getElementById("instruccionsBtn").addEventListener("click",function(){window.open("https://github.com/MSdM0/NoEsferatu/blob/main/instruccions.pdf","_blank")});document.getElementById("netejarBtn").addEventListener("click",function(){if(confirm("Est√†s segur que vols netejar tots els camps i esborrar les dades desades?")){document.getElementById("textComplert").value="";document.getElementById("dadesUnificades").value="";sessionStorage.removeItem("esfera_dades_alumnes");sessionStorage.removeItem("esfera_ordre_alumnes");ordreOriginal=[];alert("Dades netejades completament.")}});document.getElementById("enganxaTotBtn").addEventListener("click",function(){var text=document.getElementById("textComplert").value;var records=processarTextMultilinia(text);var dades={};ordreOriginal=[];for(var i=0;i<records.length;i++){var record=records[i];if(record.id.trim()){var cleanId=record.id.trim();dades[cleanId]={nom:record.nom.trim(),nota:record.nota.trim()===""?"en blanc":record.nota.trim(),comentari:netejarCometes(record.comentari.trim())};ordreOriginal.push(cleanId);}}actualitzarVisualitzacio(ordreOriginal,dades);var totalAlumnes=Object.keys(dades).length;var ambNotes=Object.values(dades).filter(d=>d.nota!==""&&d.nota.toLowerCase()!=="en blanc").length;var ambComentaris=Object.values(dades).filter(d=>d.comentari!=="").length;sessionStorage.setItem("esfera_dades_alumnes",JSON.stringify(dades));sessionStorage.setItem("esfera_ordre_alumnes",JSON.stringify(ordreOriginal));alert("Dades enganxades i desades autom√†ticament.\n- Total alumnes: "+totalAlumnes+"\n- Amb notes: "+ambNotes+"\n- Amb comentaris: "+ambComentaris);});document.getElementById("desaDadesBtn").addEventListener("click",function(){var result=parseTextareaUnificada();var dades=result.dades;ordreOriginal=result.ordre;actualitzarVisualitzacio(ordreOriginal,dades);var totalAlumnes=Object.keys(dades).length;var ambNotes=Object.values(dades).filter(d=>d.nota!==""&&d.nota.toLowerCase()!=="en blanc").length;var ambComentaris=Object.values(dades).filter(d=>d.comentari!=="").length;sessionStorage.setItem("esfera_dades_alumnes",JSON.stringify(dades));sessionStorage.setItem("esfera_ordre_alumnes",JSON.stringify(ordreOriginal));alert("Modificacions desades correctament.\n- Total alumnes: "+totalAlumnes+"\n- Amb notes: "+ambNotes+"\n- Amb comentaris: "+ambComentaris)});document.getElementById("processarBtn").addEventListener("click",function(){if(!confirm("Est√†s segur que vols executar el processament per introduir notes i comentaris?"))return;if(window._processingEsfera===true){alert("Ja hi ha un proc√©s en marxa. Espera que acabi.");return;}window._processingEsfera=true;var result=parseTextareaUnificada();var d=result.dades;if(!Object.keys(d).length){alert("No hi ha dades per processar. Primer introdueix les dades al textarea.");window._processingEsfera=false;return;}console.clear();console.log("Iniciant entrada de notes i comentaris...");var alumnesPerProcessar=obtenirAlumnesPerProcessar(d);var noTrobats=Object.keys(d).filter(id=>!alumnesPerProcessar.some(ap=>ap.id===id));var t=0,e=0,nreals=0,creals=0;var conflictes=[],indexActual=0,acceptarTots=false,cancelarTot=false;function crearModal(m,cb){var o=document.createElement('div');o.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000000;display:flex;align-items:center;justify-content:center;font-family:Arial,sans-serif';var md=document.createElement('div');md.style.cssText='background:white;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,0.3);max-width:min(700px,90vw);width:90%;max-height:80vh;padding:20px;display:flex;flex-direction:column';var contentDiv=document.createElement('div');contentDiv.style.cssText='flex:1;overflow:auto;margin-bottom:20px';contentDiv.innerHTML='<h3 style="margin:0 0 15px 0;color:#d32f2f;font-size:16px">‚ö†%EF%B8%8F Dades preexistents detectades</h3><div style="background:#f5f5f5;padding:15px;border-radius:4px;white-space:pre-line;font-family:monospace;font-size:13px;max-height:300px;overflow-y:auto">'+m+'</div>';var buttonsDiv=document.createElement('div');buttonsDiv.style.cssText='text-align:center;flex-shrink:0';buttonsDiv.innerHTML='<button id="btnRevisar" style="background:#2196f3;color:white;border:none;padding:10px 15px;margin:5px;border-radius:4px;cursor:pointer;font-size:13px">Revisar un per un</button><button id="btnTots" style="background:#4caf50;color:white;border:none;padding:10px 15px;margin:5px;border-radius:4px;cursor:pointer;font-size:13px">Canviar tots</button><button id="btnSenseConflictes" style="background:#ff9800;color:white;border:none;padding:10px 15px;margin:5px;border-radius:4px;cursor:pointer;font-size:13px">Nom√©s sense conflictes</button><button id="btnCancel" style="background:#f44336;color:white;border:none;padding:10px 15px;margin:5px;border-radius:4px;cursor:pointer;font-size:13px">Cancel¬∑lar</button>';md.appendChild(contentDiv);md.appendChild(buttonsDiv);o.appendChild(md);document.body.appendChild(o);md.querySelector('#btnRevisar').onclick=function(){document.body.removeChild(o);cb(1);};md.querySelector('#btnTots').onclick=function(){document.body.removeChild(o);cb(2);};md.querySelector('#btnSenseConflictes').onclick=function(){document.body.removeChild(o);cb(4);};md.querySelector('#btnCancel').onclick=function(){document.body.removeChild(o);cb(3);};}function processarSenseConflictes(){var alumnesConConflicte=conflictes.map(c=>c.id);alumnesPerProcessar=alumnesPerProcessar.filter(ap=>!alumnesConConflicte.includes(ap.id));iniciarProcessament();}function obtenirComentariExistent(fila,callback){var iconaComentari=fila.querySelector(".glyphicon-new-window, .emptyIcon");if(!iconaComentari||iconaComentari.classList.contains('emptyIcon')){callback("");return;}iconaComentari.click();setTimeout(function(){var textarea=document.querySelector("textarea");if(!textarea){callback("");return;}var comentariText=textarea.value.trim();var modal=textarea.closest(".modal-content, .dialog, form");var botoCancelar=modal.querySelector(".btn:not(.btn-primary)")||Array.from(modal.querySelectorAll("button,a")).find(e=>e.textContent.trim().toLowerCase().includes("cancel")||e.textContent.trim().toLowerCase().includes("tancar"));if(botoCancelar){botoCancelar.click();}else{document.dispatchEvent(new KeyboardEvent('keydown',{key:'Escape'}));}callback(comentariText);},500);}function detectarConflictes(){conflictes=[];var currentIndex=0;function processNextRow(){if(cancelarTot){window._processingEsfera=false;return;}if(currentIndex>=alumnesPerProcessar.length){if(conflictes.length>0){mostrarResumConflictes();}else{iniciarProcessament();}return;}var ap=alumnesPerProcessar[currentIndex];var r=ap.fila;var i=ap.id;var a=ap.alumne;var nomCols=[];for(var colIndex=2;colIndex<=4;colIndex++){var col=r.querySelector('td:nth-child('+colIndex+')');if(col&&col.textContent.trim()){nomCols.push(col.textContent.trim());}}var nomAlumne=nomCols.length>0?nomCols.join(' '):'Nom no trobat';var novaNotaStr=(a.nota||"").trim();var nouComentari=netejarCometes((a.comentari||"").trim());var notaExistent="";var l=r.querySelector('input.form-control:not([disabled])');if(l&&l.value.trim()!==""){notaExistent=l.value.trim();}else{var s=r.querySelector('select');if(s&&s.value!==""&&s.selectedIndex>0){notaExistent=s.options[s.selectedIndex].text.trim();}}obtenirComentariExistent(r,function(comentariExistent){if(cancelarTot){window._processingEsfera=false;return;}var hiHaNotaExistent=(notaExistent!=="");var hiHaComentariExistent=(comentariExistent.trim()!=="");var volCanviarNota=(novaNotaStr!=="en blanc"&&novaNotaStr!=="");var volCanviarComentari=(nouComentari.trim()!=="");var conflicteNota=hiHaNotaExistent&&volCanviarNota;var conflicteComentari=hiHaComentariExistent&&volCanviarComentari;if(conflicteNota||conflicteComentari){conflictes.push({fila:r,id:i,nom:nomAlumne,alumne:a,notaExistent:notaExistent,comentariExistent:comentariExistent,conflicteNota:conflicteNota,conflicteComentari:conflicteComentari});}currentIndex++;setTimeout(processNextRow,200);});}processNextRow();}function mostrarResumConflictes(){if(cancelarTot){window._processingEsfera=false;return;}var m="S'han detectat "+conflictes.length+" alumnes amb dades preexistents:\n\n";conflictes.forEach(function(c,i){m+=(i+1)+". "+c.nom+" ("+c.id+")\n";});m+="\nQu√© vols fer?";crearModal(m,function(resp){if(cancelarTot){window._processingEsfera=false;return;}if(resp===2){acceptarTots=true;iniciarProcessament();}else if(resp===3){cancelarTot=true;window._processingEsfera=false;alert("Proc√©s cancel¬∑lat per l'usuari.");}else if(resp===4){processarSenseConflictes();}else{mostrarConflicte(0);}});}function mostrarConflicte(index){if(cancelarTot){window._processingEsfera=false;alert("Proc√©s cancel¬∑lat per l'usuari.");return;}if(acceptarTots||index>=conflictes.length){iniciarProcessament();return;}var c=conflictes[index];var m="CONFLICTE "+(index+1)+" de "+conflictes.length+":\nüë§ "+c.nom+" (ID: "+c.id+")\n\nüìù NOTA EXISTENT: "+(c.notaExistent||"(cap)")+"\nüìù NOVA NOTA: "+(c.alumne.nota==="en blanc"?"(cap)":(c.alumne.nota||"(cap)"))+"\n\nüí¨ COMENTARI EXISTENT: "+(c.comentariExistent||"(cap)")+"\nüí¨ NOU COMENTARI: "+(netejarCometes(c.alumne.comentari.trim())?netejarCometes(c.alumne.comentari):"(cap)")+"\n\nVols SOBREESCRIURE amb les noves dades?";if(confirm(m)){mostrarConflicte(index+1);}else{alumnesPerProcessar=alumnesPerProcessar.filter(ap=>ap.id!==c.id);mostrarConflicte(index+1);}}function iniciarProcessament(){if(cancelarTot){window._processingEsfera=false;return;}processar();}function processar(){if(cancelarTot){window._processingEsfera=false;return;}if(alumnesPerProcessar.length===0){var r="Proc√©s completat!\n‚úî%EF%B8%8F Processats: "+t+"\nüìù Notes reals: "+nreals+"\nüí¨ Comentaris reals: "+creals+"\n‚ùå Errors: "+e;if(noTrobats.length)r+="\n‚ùì Alumnes no trobats:\n"+noTrobats.join(", ");alert(r);window._processingEsfera=false;return;}var ap=alumnesPerProcessar.shift();var r=ap.fila;var i=ap.id;var a=ap.alumne;var o=(a.nota||"").trim();var m=netejarCometes((a.comentari||"").trim());console.log("Processant ID:",i,"Nota:",o,"Comentari:",m);try{if(o!=="en blanc"&&o!==""){nreals++;var l=r.querySelector('input.form-control:not([disabled])');if(l){l.value=o.replace(",",".");l.dispatchEvent(new Event('input',{bubbles:true}));l.dispatchEvent(new Event('change',{bubbles:true}));l.dispatchEvent(new Event('blur',{bubbles:true}));console.log("Nota num√®rica introdu√Øda:",l.value);}else{var s=r.querySelector('select');if(s){var v=false;for(var j=0;j<s.options.length;j++){if(s.options[j].text.trim()===o){s.value=s.options[j].value;v=true;break;}}if(!v)s.value="string:"+o;s.dispatchEvent(new Event('change',{bubbles:true}));console.log("Nota de text introdu√Øda:",o);}else{console.warn("No s'ha trobat ni input ni select per la nota.");e++;}}}else{var l=r.querySelector('input.form-control:not([disabled])');if(l){l.value="";l.dispatchEvent(new Event('input',{bubbles:true}));l.dispatchEvent(new Event('change',{bubbles:true}));l.dispatchEvent(new Event('blur',{bubbles:true}));console.log("Nota esborrada.");}else{var s=r.querySelector('select');if(s){s.value="";s.dispatchEvent(new Event('change',{bubbles:true}));console.log("Nota de text esborrada.");}}}}catch(x){console.error("Error amb la nota per ID:",i,x);e++;}processarComentari(r,m,function(k){if(cancelarTot){window._processingEsfera=false;return;}if(k&&m.trim()!==""){creals++;t++;}else if(k){t++;}else{e++;}setTimeout(processar,500);});}function processarComentari(r,m,b){if(cancelarTot){window._processingEsfera=false;return b(false);}try{var y=r.querySelector(".glyphicon-new-window, .emptyIcon");if(!y){console.warn("No s'ha trobat bot√≥ comentari.");return b(true);}y.click();setTimeout(function(){if(cancelarTot){window._processingEsfera=false;return b(false);}var x=document.querySelector("textarea");if(!x){console.warn("No s'ha trobat textarea.");return b(false);}x.value=m;x.dispatchEvent(new Event('input',{bubbles:true}));x.dispatchEvent(new Event('change',{bubbles:true}));setTimeout(function(){if(cancelarTot){window._processingEsfera=false;return b(false);}var z=x.closest(".modal-content, .dialog, form");var B=z.querySelector(".btn.btn-primary")||Array.from(z.querySelectorAll("button,a")).find(e=>e.textContent.trim().toLowerCase()==="desa");if(B){B.click();console.log("Comentari processat.");b(true);}else{console.error("No s'ha trobat el bot√≥ Desa.");b(false);}},300);},500);}catch(x){console.error("Error amb comentari:",x);b(false);}}detectarConflictes();});constrainPosition();})();
